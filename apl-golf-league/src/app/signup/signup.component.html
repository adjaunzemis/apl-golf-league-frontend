<mat-tab-group class="content" animationDuration="0ms" style="width: 100%">
  <mat-tab label="Flight Sign-Ups">

    <div class="content" *ngIf="!isLoadingFlights && !isLoadingGolfers">

      <div class="card announcements-card card-small">
        <h2>Membership Dues</h2>

        <span class="bold">Full: $45.00 USD | Tournament-Only: $40.00 USD</span>
        <span class="regular">Dues may be paid through PayPal or by writing a check.</span>
        <span>Drop off checks at Bob’s office 200-E352 (place check on the desk).</span>
      </div>

      <mat-form-field appearance="fill">
        <mat-label>Select Flight</mat-label>
        <mat-select [formControl]="flightControl" required>
          <mat-option>--</mat-option>
          <mat-option *ngFor="let flight of flights" [value]="flight" (click)="getSelectedFlightData(flight.id)">{{ flight.name }} ({{ flight.year }})</mat-option>
        </mat-select>
        <mat-error *ngIf="flightControl.hasError('required')">Please choose a flight</mat-error>
      </mat-form-field>

      <div class="content" *ngIf="!flightControl.hasError('required') && selectedFlight && !isLoadingSelectedFlight">

        <div class="content" *ngIf="isSelectedFlightSignupWindowOpen; else flightSignupWindowClosed">

          <h2>Add Team</h2>

          <div>
            <mat-form-field class="team-name-input" appearance="fill">
                <mat-label>Team Name</mat-label>
                <input matInput required [formControl]="teamNameControl" placeholder="Ex. Teamy McTeamFace" title="Enter team name." value="">
                <mat-error *ngIf="teamNameControl.hasError('required')">Please enter a team name</mat-error>
                <mat-error *ngIf="teamNameControl.hasError('minlength')">Team name is too short</mat-error>
                <mat-error *ngIf="teamNameControl.hasError('maxlength')">Team name is too long</mat-error>
            </mat-form-field>

            <button mat-raised-button color="accent" [disabled]="!teamNameControl.valid || !newTeamForm.valid" (click)="onSubmitFlightTeam()">Submit</button>

            <button mat-raised-button color="primary" (click)="onAddNewGolfer()">New Golfer</button>

          </div>

          <form [formGroup]="newTeamForm" (ngSubmit)="onSubmitFlightTeam()" (keydown.enter)="$event.preventDefault()">
            <div formArrayName="teamGolfers" *ngFor="let teamGolfer of getTeamGolfersArray().controls; let idx = index">
              <div formGroupName="{{ idx }}">

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Golfer</mat-label>
                  <input type="text" matInput required title="Start typing golfer name to autocomplete." formControlName="golfer" [matAutocomplete]="auto">
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let g of filteredGolferOptionsArray[idx] | async" [value]="g.name">{{ g.name }}</mat-option>
                  </mat-autocomplete>
                  <mat-error *ngIf="teamGolfer.get('golfer')?.hasError('required')">Select a golfer</mat-error>
                  <mat-error *ngIf="teamGolfer.get('golfer')?.hasError('golferNameInvalid')">Golfer name is not valid</mat-error>
                </mat-form-field>

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Role</mat-label>
                  <mat-select formControlName="role" required>
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let r of roleOptions" [value]="r">{{ r }}</mat-option>
                  </mat-select>
                  <mat-error *ngIf="teamGolfer.get('role')?.hasError('required')">Select a role</mat-error>
                </mat-form-field>

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Division</mat-label>
                  <mat-select formControlName="division" required>
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let d of selectedFlight.divisions" [value]="d">{{ d.name }}</mat-option>
                  </mat-select>
                  <mat-error *ngIf="teamGolfer.get('division')?.hasError('required')">Select a division</mat-error>
                </mat-form-field>

                <button mat-raised-button color="warn" (click)="removeNewTeamGolferForm(idx)" [disabled]="getTeamGolfersArray().length < 2">-</button>

                <button mat-raised-button color="primary" (click)="addNewTeamGolferForm()" *ngIf="idx === getTeamGolfersArray().length - 1">+</button>

              </div>
            </div>
          </form>

        </div>

        <ng-template #flightSignupWindowClosed>
          <div class="content">
            <h3 class="italic" *ngIf="this.selectedFlight.signup_start_date > this.currentDate">Sign-up window opens in {{ getDaysUntilSignup() }} days!</h3>
            <h3 class="italic" *ngIf="this.selectedFlight.signup_stop_date < this.currentDate">Sign-up window is closed</h3>
          </div>
        </ng-template>


        <h2>{{ selectedFlight.name | titlecase }} ({{ selectedFlight.year }}) Flight Info</h2>

        <div class="card-container">
          <a class="card card-small selectable" href="mailto:{{ selectedFlight.secretary_email }}">
            <span class="bold">Secretary</span>
            <span>{{ selectedFlight.secretary }}</span>
          </a>

          <div class="card card-small">
            <span class="bold">Course</span>
            <span>{{ selectedFlight.course }}</span>
          </div>

          <div class="card card-small">
            <span class="bold">Sign-Up Dates</span>
            <span>{{ selectedFlight.signup_start_date | date:'longDate' }} - {{ selectedFlight.signup_stop_date | date:'longDate' }}</span>
          </div>

          <div class="card card-small">
            <span class="bold">Start Date</span>
            <span>{{ selectedFlight.start_date | date:'longDate' }}</span>
          </div>
        </div>

        <h3>Divisions</h3>

        <app-division-list [divisions]="selectedFlight.divisions"></app-division-list>

        <h3>Teams</h3>

        <p class="italic" *ngIf="selectedFlight.teams?.length === 0">No teams have signed-up yet...</p>

        <div class="card-container team-list">
          <a class="card team-card" *ngFor="let team of selectedFlight.teams">
            <span class="bold">{{ team.name }}</span>
            <div *ngFor="let golfer of team.golfers">
              <span>{{ golfer.golfer_name }} - {{ golfer.division_name }} - Hcp: </span>
              <span *ngIf="golfer.handicap_index; else noHandicapIndex">{{ golfer.handicap_index | number:'1.1' }}</span>
              <ng-template #noHandicapIndex>
                <span>--</span>
              </ng-template>

            </div>
          </a>
        </div>

      </div>
    </div>

  </mat-tab>

  <mat-tab label="Tournament Sign-Ups">

    <div class="content" *ngIf="!isLoadingTournaments && !isLoadingGolfers">

      <div class="card announcements-card card-small">
        <h2>Membership Dues</h2>

        <span class="bold">Full: $45.00 USD | Tournament-Only: $40.00 USD</span>
        <span class="regular">Dues may be paid through PayPal or by writing a check.</span>
        <span>Drop off checks at Bob’s office 200-E352 (place check on the desk).</span>
      </div>

      <mat-form-field appearance="fill">
        <mat-label>Select Tournament</mat-label>
        <mat-select [formControl]="tournamentControl" required>
          <mat-option>--</mat-option>
          <mat-option *ngFor="let tournament of tournaments" [value]="tournament" (click)="getSelectedTournamentData(tournament.id)">{{ tournament.name }} ({{ tournament.year }})</mat-option>
        </mat-select>
        <mat-error *ngIf="tournamentControl.hasError('required')">Please choose a tournament</mat-error>
      </mat-form-field>

      <div class="content" *ngIf="!tournamentControl.hasError('required') && selectedTournament && !isLoadingSelectedTournament">

        <div class="content" *ngIf="isSelectedTournamentSignupWindowOpen; else flightSignupWindowClosed">

          <h2>Add Team</h2>

          <div>
            <mat-form-field class="team-name-input" appearance="fill">
                <mat-label>Team Name</mat-label>
                <input matInput required [formControl]="teamNameControl" placeholder="Ex. Teamy McTeamFace" title="Enter team name." value="">
                <mat-error *ngIf="teamNameControl.hasError('required')">Please enter a team name</mat-error>
                <mat-error *ngIf="teamNameControl.hasError('minlength')">Team name is too short</mat-error>
                <mat-error *ngIf="teamNameControl.hasError('maxlength')">Team name is too long</mat-error>
            </mat-form-field>

            <button mat-raised-button color="accent" [disabled]="!teamNameControl.valid || !newTeamForm.valid" (click)="onSubmitTournamentTeam()">Submit</button>

            <button mat-raised-button color="primary" (click)="onAddNewGolfer()">New Golfer</button>

          </div>

          <form [formGroup]="newTeamForm" (ngSubmit)="onSubmitTournamentTeam()" (keydown.enter)="$event.preventDefault()">
            <div formArrayName="teamGolfers" *ngFor="let teamGolfer of getTeamGolfersArray().controls; let idx = index">
              <div formGroupName="{{ idx }}">

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Golfer</mat-label>
                  <input type="text" matInput required title="Start typing golfer name to autocomplete." formControlName="golfer" [matAutocomplete]="auto">
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let g of filteredGolferOptionsArray[idx] | async" [value]="g.name">{{ g.name }}</mat-option>
                  </mat-autocomplete>
                  <mat-error *ngIf="teamGolfer.get('golfer')?.hasError('required')">Select a golfer</mat-error>
                  <mat-error *ngIf="teamGolfer.get('golfer')?.hasError('golferNameInvalid')">Golfer name is not valid</mat-error>
                </mat-form-field>

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Role</mat-label>
                  <mat-select formControlName="role" required>
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let r of roleOptions" [value]="r">{{ r }}</mat-option>
                  </mat-select>
                  <mat-error *ngIf="teamGolfer.get('role')?.hasError('required')">Select a role</mat-error>
                </mat-form-field>

                <mat-form-field appearance="fill" class="input-field">
                  <mat-label>Division</mat-label>
                  <mat-select formControlName="division" required>
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let d of selectedTournament.divisions" [value]="d">{{ d.name }}</mat-option>
                  </mat-select>
                  <mat-error *ngIf="teamGolfer.get('division')?.hasError('required')">Select a division</mat-error>
                </mat-form-field>

                <button mat-raised-button color="warn" (click)="removeNewTeamGolferForm(idx)" [disabled]="getTeamGolfersArray().length < 2">-</button>

                <button mat-raised-button color="primary" (click)="addNewTeamGolferForm()" *ngIf="idx === getTeamGolfersArray().length - 1">+</button>

              </div>
            </div>
          </form>

        </div>

        <ng-template #flightSignupWindowClosed>
          <div class="content">
            <h3 class="italic" *ngIf="this.selectedTournament.signup_start_date > this.currentDate">Sign-up window opens in {{ getDaysUntilSignup() }} {{ getDaysUntilSignup() > 1 ? 'days' : 'day' }}!</h3>
            <h3 class="italic" *ngIf="this.selectedTournament.signup_stop_date < this.currentDate">Sign-up window is closed</h3>
          </div>
        </ng-template>


        <h2>{{ selectedTournament.name | titlecase }} ({{ selectedTournament.year }}) Flight Info</h2>

        <div class="card-container">
          <a class="card card-small selectable" href="mailto:{{ selectedTournament.secretary_email }}">
            <span class="bold">Secretary</span>
            <span>{{ selectedTournament.secretary }}</span>
          </a>

          <div class="card card-small">
            <span class="bold">Course</span>
            <span>{{ selectedTournament.course }}</span>
          </div>

          <div class="card card-small">
            <span class="bold">Sign-Up Dates</span>
            <span>{{ selectedTournament.signup_start_date | date:'longDate' }} - {{ selectedTournament.signup_stop_date | date:'longDate' }}</span>
          </div>

          <div class="card card-small">
            <span class="bold">Tournament Date</span>
            <span>{{ selectedTournament.date | date:'longDate' }}</span>
          </div>
        </div>

        <h3>Divisions</h3>

        <app-division-list [divisions]="selectedTournament.divisions"></app-division-list>

        <h3>Teams</h3>

        <p class="italic" *ngIf="selectedTournament.teams?.length === 0">No teams have signed-up yet...</p>

        <div class="card-container team-list">
          <a class="card team-card" *ngFor="let team of selectedTournament.teams">
            <span class="bold">{{ team.name }}</span>
            <div *ngFor="let golfer of team.golfers">
              <span>{{ golfer.golfer_name }} - {{ golfer.division_name }} - Hcp: </span>
              <span *ngIf="golfer.handicap_index; else noHandicapIndex">{{ golfer.handicap_index | number:'1.1' }}</span>
              <ng-template #noHandicapIndex>
                <span>--</span>
              </ng-template>

            </div>
          </a>
        </div>

      </div>

    </div>

  </mat-tab>

</mat-tab-group>

<mat-spinner *ngIf="isLoadingFlights || isLoadingGolfers || isLoadingSelectedFlight"></mat-spinner>
